const hevPlaylist = [
    {
        name: "Balisa",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - BALISA.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "I know",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - I KNOW ft. Mcee Zabala - BONUS.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "Introhan Natin",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - INTROHAN NATIN.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "Manhid",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - MANHID.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "Pantasya Panaginip",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - PANTASYA PANAGINIP.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "Pulang Karpet",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - PULANG KARPET.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "Pwede bang?",
        album: "Pautang ng Pagibig",
        src: "res/songs/Pautang ng Pagibig/Hev Abi - PWEDE BANG_.mp3",
        cover: "res/assets/cover_1.jpg"
    },
    {
        name: "1999",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - 1999 feat. Harlem.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Albat",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Albat feat. Unotheone.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Ganggang",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Gang Gang feat. Unotheone (Official Music Video).mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "ganitongrapbalikongcap",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - ganitongrapbalikongcap  3 Sticks.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Lahat Gagawin",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Lahat Gagawin.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Late Kenanrd",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Late Kenanrd feat. L.K, Unotheone, & A77EX.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Magka Kotse",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Magka Kotse.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Nice Tin",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Nice Tin feat. L.K & Unotheone.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Outside",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Outside (Official Music Video).mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Paano Ka Ba",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Paano Ka Ba_.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Para Sikat",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Para Sikat feat.  Unotheone & A77EX.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Sa Dako Paroon (Interlude)",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Sa Dako Paroon (Interlude).mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Tagaytay",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Tagaytay.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Walang Makapa",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Hev Abi - Walang Makapa (Official Music Video).mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Loyal To Everybody",
        album: "Sakred Boy",
        src: "res/songs/Sakred Boy/Loyal To Everybody.mp3",
        cover: "res/assets/cover_3.jpg"
    },
    {
        name: "Alam mo ba Girl",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Alam Mo Ba Girl.mp3",
        cover: "res/assets/cover_2.jpg"
    },
    {
        name: "Antagonista",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Antagonista feat. Unotheone.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Binibiroksi",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Binibiroksi.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "C2 Boyz",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - C2 Boyz.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "drugr4ts",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - drugr4ts feat. Simmo, gins&melodies.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "From Torillo, With Love",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - From Torillo, With Love.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Introhan Ko Lang",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Introhan Ko Lang.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Kulay Downtown",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Kulay Downtown feat. Kristina Dawn.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Pasaway Mode",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Pasaway Mode feat. Nazty Kidd.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Still",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Still.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Sumugal",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Sumugal feat. Unotheone, LK.mp3",
        cover: "res/assets/cover_2.jpg"
    }, 
    {
        name: "Walang Alam",
        album: "Kung Alam Mo Lang",
        src: "res/songs/Kung Alam Mo Lang/Hev Abi - Walang Alam.mp3",
        cover: "res/assets/cover_2.jpg"
    },      
    {
        name: "Sa Kabila",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/Sa Kabila.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "151 - B",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/151 - B.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "Missing Piece",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/Missing Piece.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "Istolok",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/Istolok.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "Ayaw - ayaw",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/Ayaw - ayaw.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "Told You",
        album: "Kwentong Jimenez",
        src: "res/songs/Kwentong Jimenez/Told You.mp3",
        cover: "res/assets/cover_4.jpg"
    },      
    {
        name: "Babaero",
        album: "Kwentong Jimenez",
        src: "res/songs/Solo Tracks/Babaero (feat. Hev Abi).mp3",
        cover: "res/assets/babaero.jpg"
    }      
]

const musicName = document.querySelector('.song-name');
const albumName = document.querySelector('.album-name');;
const prog = document.querySelector('.progress-bar');
const fillBar = document.querySelector('.fill-bar');
const time = document.querySelector('.time')

const cover = document.getElementById('cover');
const playBtn = document.getElementById('play-pause-button');
const prevBtn = document.getElementById('backward-button');
const nextBtn = document.getElementById('forward-button');
const playImg = document.getElementById('play-pause');
const shuffleBtn = document.getElementById('shuffle-button');
const repeatBtn = document.getElementById('repeat-button');
const repeatIco = document.getElementById('repeat');
const shuffleIco = document.getElementById('shuffle');


let song = new Audio();
let currentSong = 0;
let playing = false;
let shuffled = false;
let repeat = false;
let originalPlaylist = [...hevPlaylist];

document.addEventListener('DOMContentLoaded', () => {
    loadSong(currentSong);
    song.addEventListener('timeupdate', updateProgress);
    song.addEventListener('ended', nextSong);
    prevBtn.addEventListener('click', prevSong);
    nextBtn.addEventListener('click', nextSong);
    playBtn.addEventListener('click', togglePlayPause);
    prog.addEventListener('click', seek);
    shuffleBtn.addEventListener('click', shuffleSongs);
    repeatBtn.addEventListener('click', repeatSong);
})

function loadSong(index) {
    const {name, album, src, cover: thumb} = hevPlaylist[index];
    musicName.innerText = name;
    albumName.innerText = album;
    song.src = src;
    cover.style.backgroundImage = `url(${thumb})`;
}

function updateProgress() {
    if(song.duration){
        const pos = (song.currentTime / song.duration) * 100;
        fillBar.style.width = `${pos}%`;

        const duration = formatTime(song.duration);
        const currentTime = formatTime(song.currentTime);
        time.innerText = `${currentTime} - ${duration}`;

        if (song.ended && repeat) {
            playMusic(); // Play the song again
        }
    }
}

function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs < 10 ? '0' : ''}${secs}`; 
}

function togglePlayPause() {
    if(playing){
        song.pause();
        playImg.src = "res/assets/play.svg";
    }else{
        song.play();
        playImg.src = "res/assets/pause.svg";
    }

    playing = !playing;
    cover.classList.toggle('active', playing);
}

function playMusic() {
    loadSong(currentSong);
    song.play();
    playing = true;
    playImg.src = "res/assets/pause.svg";
    cover.classList.toggle('active', playing);
}

function seek(e) {
    const pos = (e.offsetX / prog.clientWidth) * song.duration;
    song.currentTime = pos;
}

function shuffle(arr) {
    for (let  i = arr.length; i > 0; i--) {
        let j = Math.floor(Math.random() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

function repeatSong() {
    repeat = !repeat;

    if(repeat){
        repeatIco.src = "res/assets/repeated.svg";
    }else{
        repeatIco.src = "res/assets/repeat.svg";
    }
}

function findSong(songName) {
    return originalPlaylist.findIndex(song => song.name === songName);
}

function shuffleSongs() {
    const currentSongName = hevPlaylist[currentSong]?.name;

    if(shuffled){
        hevPlaylist.splice(0, hevPlaylist.length, ...originalPlaylist); //returns the real arrangement
        shuffleIco.src = "res/assets/shuffle.svg";
    }else{ 
        // shuffled
        shuffle(hevPlaylist);
        shuffleIco.src = "res/assets/shuffled.svg";
    }
    
    currentSong = hevPlaylist.findIndex(song => song.name === currentSongName);

    shuffled = !shuffled;
}

function nextSong() {
    currentSong = (currentSong + 1) % hevPlaylist.length;
    playMusic();
}

function prevSong() {
    currentSong = (currentSong - 1 + hevPlaylist.length) % hevPlaylist.length;
    playMusic();
}